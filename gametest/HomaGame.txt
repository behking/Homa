<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homa - Build to Impact</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body {
            margin: 0; padding: 0;
            background-color: #0d1117;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; font-family: 'Arial', sans-serif;
            overflow: hidden; color: white; user-select: none;
        }
        #gameContainer {
            position: relative; width: 100%; max-width: 400px; height: 600px;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
            overflow: hidden; border: 2px solid #333; border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        /* Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª Ù…Ø¯Ø±Ø³Ù‡ */
        #projectStatus {
            position: absolute; top: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.6); color: #fff;
            padding: 8px 0; text-align: center; font-size: 12px; z-index: 15;
            border-bottom: 2px solid #FFD700;
        }
        #scoreBoard {
            position: absolute; top: 40px; left: 20px;
            font-size: 24px; font-weight: bold; color: #333; z-index: 10;
        }
        #startScreen, #gameOverScreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 20; text-align: center; backdrop-filter: blur(5px);
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ UI */
        .panel {
            background: white; color: #333; padding: 20px;
            border-radius: 15px; width: 80%; max-width: 300px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        h1 { margin: 0 0 10px 0; color: #FFD700; text-shadow: 1px 1px 2px black; }
        h2 { margin: 0 0 10px 0; color: #333; font-size: 22px; }
        
        button.action-btn {
            background: linear-gradient(45deg, #FF4500, #FF8C00);
            border: none; padding: 12px 25px; color: white;
            font-size: 18px; border-radius: 25px; cursor: pointer;
            margin-top: 10px; width: 100%; font-weight: bold;
            box-shadow: 0 4px #c0392b; transition: all 0.1s;
        }
        button.action-btn:active { transform: translateY(2px); box-shadow: 0 2px #c0392b; }
        
        /* Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ø¯ÙˆÙ†ÛŒØ´Ù† */
        .donation-control { margin: 15px 0; text-align: center; }
        input[type=range] { width: 100%; margin: 10px 0; }
        .price-tag { background: #E8F5E9; color: #2E7D32; padding: 5px 10px; border-radius: 5px; font-weight: bold; display: block; margin-top: 5px;}
        
        .hidden { display: none !important; }

        /* Ú¯Ø±Ø§ÙÛŒÚ© Ø¨Ø§Ø²ÛŒ */
        #player {
            position: absolute; width: 40px; height: 40px;
            background-color: #FFD700; border-radius: 8px;
            border: 3px solid #B8860B; bottom: 100px; left: 50px;
        }
        .obstacle {
            position: absolute; width: 35px; background-color: #5D4037;
            bottom: 100px; border-radius: 5px; border: 2px solid #3E2723;
        }
        #ground {
            position: absolute; bottom: 0; width: 100%; height: 100px;
            background-color: #4CAF50; border-top: 6px solid #2E7D32;
        }
    </style>
</head>
<body>

<div id="gameContainer">
    <div id="projectStatus">
        ğŸ—ï¸ Ù¾Ø±ÙˆÚ˜Ù‡ Ù…Ø¯Ø±Ø³Ù‡: <b>ÙØ§Ø² Û± - ÙÙˆÙ†Ø¯Ø§Ø³ÛŒÙˆÙ†</b><br>
        Ù¾ÛŒØ´Ø±ÙØª Ø¨ÙˆØ¯Ø¬Ù‡: <span style="color:#4CAF50">0.0 ETH</span> / 0.5 ETH
    </div>

    <div id="scoreBoard">Ø§Ù…ØªÛŒØ§Ø²: 0</div>
    
    <div id="startScreen">
        <h1>HOMA RUNNER</h1>
        <p style="color:#eee">Ø¨Ø¯ÙˆØŒ Ø¨Ø³Ø§Ø²ØŒ ØªØ§Ø«ÛŒØ± Ø¨Ú¯Ø°Ø§Ø±!</p>
        <button class="action-btn" onclick="startGame(event)">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
    </div>

    <div id="gameOverScreen" class="hidden">
        <div class="panel">
            <h2>Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ!</h2>
            <div style="font-size: 14px; color: #555;">Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ (Ø¢Ø¬Ø±):</div>
            <div id="finalScoreDisplay" style="font-size: 30px; font-weight: bold; color: #d35400;">0</div>
            
            <hr style="border: 1px solid #eee; margin: 15px 0;">
            
            <div class="donation-control">
                <label>Ø¶Ø±ÛŒØ¨ Ø¯ÙˆÙ†ÛŒØ´Ù†: <span id="multiplierValue" style="color:#2980b9; font-weight:bold;">1x</span></label>
                <input type="range" id="multiplierSlider" min="1" max="100" value="1" oninput="updateDonationCalc()">
                
                <div style="font-size: 12px; margin-top:5px;">Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø± Ù„ÛŒØ¯Ø±Ø¨ÙˆØ±Ø¯:</div>
                <div id="finalRankScore" style="font-size: 18px; font-weight: bold;">0</div>
                
                <span class="price-tag">Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: <span id="ethCost">0.00001</span> ETH</span>
            </div>

            <button class="action-btn" style="background: linear-gradient(45deg, #27ae60, #2ecc71);" onclick="processPayment()">
                â¤ï¸ Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ Ø«Ø¨Øª
            </button>
            <button onclick="startGame(event)" style="background:none; border:none; color:#777; margin-top:10px; cursor:pointer; text-decoration:underline;">Ø¨Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ (Ø¨Ø¯ÙˆÙ† Ø«Ø¨Øª)</button>
        </div>
    </div>

    <div id="player"></div>
    <div id="ground"></div>
</div>

<script>
    // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù„Ø§Ú©Ú†ÛŒÙ† ---
    // Ø¢Ø¯Ø±Ø³ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
    const CONTRACT_ADDRESS = "0xYOUR_CONTRACT_ADDRESS_HERE"; 
    const BASE_PRICE = 0.00001; // Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ø§ØªØ± Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø§Ù…ØªÛŒØ§Ø²

    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
    const player = document.getElementById('player');
    const gameContainer = document.getElementById('gameContainer');
    const scoreBoard = document.getElementById('scoreBoard');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ UI Ø¯ÙˆÙ†ÛŒØ´Ù†
    const finalScoreDisplay = document.getElementById('finalScoreDisplay');
    const multiplierSlider = document.getElementById('multiplierSlider');
    const multiplierValue = document.getElementById('multiplierValue');
    const finalRankScore = document.getElementById('finalRankScore');
    const ethCost = document.getElementById('ethCost');

    let isGameRunning = false;
    let score = 0;
    let playerBottom = 100;
    let jumpSpeed = 0;
    let obstacles = [];
    let gameLoopId, obstacleTimerId;

    // --- Ù…Ù†Ø·Ù‚ Ø¨Ø§Ø²ÛŒ (Game Logic) ---
    gameContainer.addEventListener('mousedown', jump);
    gameContainer.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); });
    document.addEventListener('keydown', (e) => { if(e.code === 'Space') jump(); });

    function startGame(event) {
        if(event) event.stopPropagation();
        clearInterval(gameLoopId); clearInterval(obstacleTimerId);
        
        isGameRunning = true; score = 0;
        obstacles.forEach(ob => ob.element.remove()); obstacles = [];
        startScreen.classList.add('hidden'); gameOverScreen.classList.add('hidden');
        playerBottom = 100; jumpSpeed = 0; player.style.bottom = '100px';
        scoreBoard.innerText = 'Ø§Ù…ØªÛŒØ§Ø²: ' + score;
        
        gameLoopId = setInterval(gameLoop, 20);
        obstacleTimerId = setInterval(createObstacle, 2000);
    }

    function jump() {
        if (!isGameRunning) return;
        if (playerBottom <= 105) jumpSpeed = 14;
    }

    function createObstacle() {
        if (!isGameRunning) return;
        const obstacle = document.createElement('div');
        obstacle.classList.add('obstacle');
        obstacle.style.left = '450px';
        obstacle.style.height = (Math.random() > 0.5 ? 40 : 65) + 'px';
        gameContainer.appendChild(obstacle);
        obstacles.push({ element: obstacle, pos: 450, passed: false });
    }

    function gameLoop() {
        if (playerBottom > 100 || jumpSpeed > 0) {
            playerBottom += jumpSpeed; jumpSpeed -= 0.8;
        } else { jumpSpeed = 0; playerBottom = 100; }
        player.style.bottom = playerBottom + 'px';

        obstacles.forEach((ob, index) => {
            ob.pos -= 6; ob.element.style.left = ob.pos + 'px';
            if (ob.pos < -50) { ob.element.remove(); obstacles.splice(index, 1); }
            if (ob.pos < 50 && !ob.passed) { score++; scoreBoard.innerText = 'Ø§Ù…ØªÛŒØ§Ø²: ' + score; ob.passed = true; }
            if (ob.pos > 10 && ob.pos < 85 && playerBottom < 100 + parseInt(ob.element.style.height) - 5) {
                gameOver();
            }
        });
    }

    function gameOver() {
        isGameRunning = false;
        clearInterval(gameLoopId); clearInterval(obstacleTimerId);
        
        // Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
        finalScoreDisplay.innerText = score;
        updateDonationCalc(); // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
        gameOverScreen.classList.remove('hidden');
    }

    // --- Ù…Ù†Ø·Ù‚ Ø¯ÙˆÙ†ÛŒØ´Ù† Ùˆ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ (UI Logic) ---
    function updateDonationCalc() {
        const multiplier = parseInt(multiplierSlider.value);
        multiplierValue.innerText = multiplier + "x";
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ
        const finalRank = score * multiplier;
        finalRankScore.innerText = finalRank;

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª: Ø§Ù…ØªÛŒØ§Ø² * Ø¶Ø±ÛŒØ¨ * Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡
        const cost = (score * multiplier * BASE_PRICE).toFixed(5);
        ethCost.innerText = cost;
    }

    async function processPayment() {
        // Ø§Ú¯Ø± Ø§Ù…ØªÛŒØ§Ø² ØµÙØ± Ø§Ø³ØªØŒ Ø§Ø¬Ø§Ø²Ù‡ Ù†Ø¯Ù‡
        if(score === 0) { alert("Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ ØµÙØ± Ø§Ø³Øª!"); return; }

        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù…ØªØ§Ù…Ø³Ú©
        if (typeof window.ethereum !== 'undefined') {
            try {
                // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                const signer = provider.getSigner();

                // Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ú©Ø§Ù†ØªØ±Ú©Øª Ø±Ø§ ØµØ¯Ø§ Ø¨Ø²Ù†ÛŒÙ…
                // ÙØ¹Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ù…Ùˆ ÛŒÚ© Ù¾ÛŒØºØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª Ù†Ø´Ø§Ù† Ù…ÛŒØ¯Ù‡ÛŒÙ… ØªØ§ ÙˆÙ‚ØªÛŒ Ú©Ø§Ù†ØªØ±Ú©Øª Ø±Ø§ Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Ú©Ù†ÛŒØ¯
                const multiplier = parseInt(multiplierSlider.value);
                const cost = (score * multiplier * BASE_PRICE).toFixed(5);
                const costInWei = ethers.utils.parseEther(cost.toString());

                // Ø¯Ø³ØªÙˆØ± Ø§ØµÙ„ÛŒ (ÙˆÙ‚ØªÛŒ Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù†ØªØ±Ú©Øª Ø±Ø§ Ú¯Ø°Ø§Ø´ØªÛŒØ¯ Ø§ÛŒÙ† Ø®Ø·ÙˆØ· Ø±Ø§ ÙØ¹Ø§Ù„ Ù…ÛŒÚ©Ù†ÛŒÙ…)
                /*
                const contract = new ethers.Contract(CONTRACT_ADDRESS, [
                    "function submitScore(uint256 score, uint256 multiplier) public payable"
                ], signer);
                
                const tx = await contract.submitScore(score, multiplier, { value: costInWei });
                alert("ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯! Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ Ø¨Ø§Ø´ÛŒØ¯...");
                await tx.wait();
                alert("ØªØ¨Ø±ÛŒÚ©! Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ Ø±ÙˆÛŒ Ø¨Ù„Ø§Ú©Ú†ÛŒÙ† Ø«Ø¨Øª Ø´Ø¯ Ùˆ Ø¢Ø¬Ø±Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ø±Ø³Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù†Ø¯.");
                */

                // Ø­Ø§Ù„Øª Ø¯Ù…Ùˆ (ÙØ¹Ù„Ø§Ù‹ Ø§ÛŒÙ† Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
                alert(`Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ:\nØ§Ø±Ø³Ø§Ù„ ${cost} ETH Ø¨Ù‡ Ú©Ø§Ù†ØªØ±Ú©Øª...\nØ¶Ø±ÛŒØ¨: ${multiplier}x\nØ§Ù…ØªÛŒØ§Ø² Ø«Ø¨Øª Ø´Ø¯Ù‡: ${score * multiplier}`);

            } catch (error) {
                console.error(error);
                alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: " + error.message);
            }
        } else {
            alert("Ù„Ø·ÙØ§Ù‹ Ú©ÛŒÙ Ù¾ÙˆÙ„ MetaMask Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯!");
        }
    }
</script>

</body>
</html>